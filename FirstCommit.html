<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paws & Claws Rescue Helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Hide sections by default */
        .app-section {
            display: none;
        }
        .gemini-response {
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-teal-600">Paws & Claws Rescue Helper</h1>
            <p id="header-subtitle" class="text-gray-600 mt-2 text-lg">Your all-in-one tool for helping animals in need.</p>
        </header>

        <!-- Dashboard Section -->
        <main id="dashboard-container" class="app-section text-center">
             <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome!</h2>
                <p class="text-gray-600 mb-6">How can we help you today?</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <button data-target="vet-finder-container" class="dashboard-option p-6 bg-teal-50 hover:bg-teal-100 rounded-lg shadow-sm transition-all transform hover:scale-105">
                        <h3 class="text-xl font-bold text-teal-700">Vet Finder</h3>
                        <p class="text-teal-600 mt-1">Find nearby vets for an injured animal.</p>
                    </button>
                     <button data-target="shelter-finder-container" class="dashboard-option p-6 bg-blue-50 hover:bg-blue-100 rounded-lg shadow-sm transition-all transform hover:scale-105">
                        <h3 class="text-xl font-bold text-blue-700">Shelter Home Finder</h3>
                        <p class="text-blue-600 mt-1">Locate a safe place for a stray.</p>
                    </button>
                     <button data-target="self-help-container" class="dashboard-option p-6 bg-indigo-50 hover:bg-indigo-100 rounded-lg shadow-sm transition-all transform hover:scale-105">
                        <h3 class="text-xl font-bold text-indigo-700">AI First-Aid Guide</h3>
                        <p class="text-indigo-600 mt-1">Get instant first-aid advice.</p>
                    </button>
                </div>
            </div>
        </main>

        <!-- Vet Finder Section -->
        <main id="vet-finder-container" class="app-section bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <button class="back-to-dashboard-btn mb-6 text-teal-600 hover:text-teal-800 font-semibold">&larr; Back to Dashboard</button>
            <div class="mb-6">
                <label for="animal-type" class="block text-lg font-medium text-gray-700 mb-2">1. What kind of animal did you find?</label>
                <select id="animal-type" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition">
                    <option value="dog">Dog</option>
                    <option value="cat">Cat</option>
                    <option value="bird">Bird</option>
                    <option value="reptile">Reptile / Snake</option>
                    <option value="small_mammal">Small Mammal (Rabbit, Guinea Pig)</option>
                    <option value="livestock">Livestock (Cow, Goat)</option>
                </select>
            </div>
            <div class="mb-6">
                 <label class="block text-lg font-medium text-gray-700 mb-2">2. Find Vets Near You</label>
                <button id="getLocationBtn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-4 focus:ring-teal-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 flex items-center justify-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    <span>Use My Current Location</span>
                </button>
            </div>
            <div id="status-container" class="mt-6 text-center"></div>
            <div id="results-container" class="mt-8 space-y-6"></div>
        </main>
        
        <!-- Shelter Finder Section -->
        <main id="shelter-finder-container" class="app-section bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <button class="back-to-dashboard-btn mb-6 text-blue-600 hover:text-blue-800 font-semibold">&larr; Back to Dashboard</button>
            <h2 class="text-3xl font-bold text-blue-700 text-center">Shelter Home Finder</h2>
            <p class="text-center mt-4 text-gray-600 mb-6">The shelter locator feature is coming soon. In the meantime, you can generate hand-off notes for the shelter.</p>
            <div class="border-t pt-6">
                <label for="shelter-animal-condition" class="block text-lg font-medium text-gray-700 mb-2">Describe the animal's condition:</label>
                <textarea id="shelter-animal-condition" rows="3" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="e.g., Small brown dog, seems to have an injured front left paw, is very scared but not aggressive. Found near the main road."></textarea>
                <button id="generate-shelter-notes-btn" class="mt-4 w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 flex items-center justify-center space-x-2">
                    ✨ Generate Shelter Hand-off Notes
                </button>
                <div id="shelter-notes-status" class="mt-6 text-center"></div>
                <div id="shelter-notes-result" class="mt-4 p-4 bg-gray-50 border rounded-lg gemini-response"></div>
            </div>
        </main>
        
        <!-- AI First Aid Section -->
        <main id="self-help-container" class="app-section bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <button class="back-to-dashboard-btn mb-6 text-indigo-600 hover:text-indigo-800 font-semibold">&larr; Back to Dashboard</button>
            <h2 class="text-3xl font-bold text-indigo-700 text-center">AI First-Aid Guide</h2>
            <div class="mt-6">
                 <label for="aid-animal-type" class="block text-lg font-medium text-gray-700 mb-2">1. Select Animal Type</label>
                 <select id="aid-animal-type" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                    <option value="dog">Dog</option>
                    <option value="cat">Cat</option>
                    <option value="bird">Bird</option>
                    <option value="reptile">Reptile / Snake</option>
                    <option value="small_mammal">Small Mammal (Rabbit, Guinea Pig)</option>
                 </select>
            </div>
            <div class="mt-4">
                <label for="aid-animal-condition" class="block text-lg font-medium text-gray-700 mb-2">2. Describe the Situation</label>
                <textarea id="aid-animal-condition" rows="3" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="e.g., 'It seems to have a broken wing', 'It is bleeding from its leg', 'It seems weak and dehydrated'"></textarea>
            </div>
             <button id="get-aid-btn" class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 flex items-center justify-center space-x-2">
                ✨ Get First-Aid Advice
            </button>
            <div id="aid-status" class="mt-6 text-center"></div>
            <div id="aid-result" class="mt-4 p-4 bg-gray-50 border rounded-lg gemini-response"></div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>&copy; 2025 Paws & Claws Rescue Helper. Helping you help them.</p>
        </footer>
    </div>

    <script type="module">
        // --- MOCK VETERINARIAN DATA ---
        const vets = [
            { name: "Dr. Anand's Pet Clinic", address: "12, Ida Scudder Road, Near CMC Hospital, Vellore", phone: "0416-222-1111", lat: 12.9221, lon: 79.1363, specialties: ["dog", "cat"], hours: "9 AM - 8 PM" },
            { name: "Vellore Veterinary Hospital (Govt.)", address: "Shenbakkam, Vellore, Tamil Nadu 632008", phone: "0416-224-2255", lat: 12.9300, lon: 79.1401, specialties: ["livestock", "dog", "cat"], hours: "24 Hours" },
            { name: "Wings & Whiskers Avian & Exotic Care", address: "45, Phase 2, Sathuvachari, Vellore", phone: "0416-225-7890", lat: 12.9255, lon: 79.1555, specialties: ["bird", "reptile", "small_mammal"], hours: "10 AM - 7 PM (By Appointment)" },
        ];

        // --- DOM ELEMENTS ---
        const allAppSections = document.querySelectorAll('.app-section');
        const headerSubtitle = document.getElementById('header-subtitle');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const animalTypeSelect = document.getElementById('animal-type');
        const resultsContainer = document.getElementById('results-container');
        const statusContainer = document.getElementById('status-container');
        // Gemini Feature Elements
        const getAidBtn = document.getElementById('get-aid-btn');
        const aidAnimalType = document.getElementById('aid-animal-type');
        const aidAnimalCondition = document.getElementById('aid-animal-condition');
        const aidStatus = document.getElementById('aid-status');
        const aidResult = document.getElementById('aid-result');
        const generateShelterNotesBtn = document.getElementById('generate-shelter-notes-btn');
        const shelterAnimalCondition = document.getElementById('shelter-animal-condition');
        const shelterNotesStatus = document.getElementById('shelter-notes-status');
        const shelterNotesResult = document.getElementById('shelter-notes-result');
        
        // --- NAVIGATION & UI STATE ---
        function showSection(sectionId) {
            allAppSections.forEach(section => { section.style.display = 'none'; });
            const activeSection = document.getElementById(sectionId);
            if (activeSection) { activeSection.style.display = 'block'; }
        }
        document.querySelectorAll('.dashboard-option').forEach(button => {
            button.addEventListener('click', (e) => showSection(e.currentTarget.getAttribute('data-target')));
        });
        document.querySelectorAll('.back-to-dashboard-btn').forEach(button => {
            button.addEventListener('click', () => showSection('dashboard-container'));
        });

        // Show the dashboard by default
        showSection('dashboard-container');

        // --- GEMINI API INTEGRATION ---
        const API_KEY = ""; // Your API key is injected in the environment
        const API_URL = https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY};
        
        async function callGeminiAPI(prompt, statusEl, resultEl) {
            statusEl.innerHTML = <div class="flex items-center justify-center p-4 bg-blue-50 border border-blue-200 rounded-lg"><div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 mr-3"></div><p class="text-blue-700 font-medium">Generating advice... Please wait.</p></div>;
            resultEl.innerHTML = '';

            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(API Error: ${response.status} ${response.statusText});
                }

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    resultEl.textContent = text;
                } else {
                    throw new Error("Received an empty response from the AI.");
                }

            } catch (error) {
                 resultEl.innerHTML = <div class="p-4 bg-red-50 border border-red-200 rounded-lg"><p class="text-red-700 font-medium">Error: Could not get advice. ${error.message}</p></div>;
            } finally {
                statusEl.innerHTML = '';
            }
        }

        getAidBtn.addEventListener('click', () => {
            const animal = aidAnimalType.value;
            const condition = aidAnimalCondition.value;
            if (!condition.trim()) {
                aidResult.textContent = "Please describe the animal's situation.";
                return;
            }
            const prompt = `You are an emergency veterinary assistant. Provide simple, safe, step-by-step first-aid advice for a person who found an injured ${animal}. The situation is: "${condition}".
            IMPORTANT: Start with a clear, bolded warning: "*DISCLAIMER: This is AI-generated advice and not a substitute for professional veterinary care. Your first priority should be to contact a veterinarian.*"
            Use simple language suitable for someone who is panicking. Use numbered steps or clear bullet points. Focus on safety for both the human and the animal.`;
            callGeminiAPI(prompt, aidStatus, aidResult);
        });

        generateShelterNotesBtn.addEventListener('click', () => {
            const condition = shelterAnimalCondition.value;
            if (!condition.trim()) {
                shelterNotesResult.textContent = "Please describe the animal's condition.";
                return;
            }
            const prompt = `You are an experienced animal rescuer. Write a brief, clear, and concise hand-off note for an animal shelter. The note should be based on the following observation from the person who found the animal: "${condition}".
            Format the output with the following headings:
            - *Animal Description:*
            - *Observed Condition/Injuries:*
            - *Temperament:*
            - *Location Found:*
            - *Immediate Concerns for Shelter Staff:*
            Fill in the details based on the user's description. If the user's description doesn't mention something (like temperament or location), write "Not specified" or make a reasonable inference. Keep it professional and to the point.`;
            callGeminiAPI(prompt, shelterNotesStatus, shelterNotesResult);
        });


        // --- VET FINDER LOGIC ---
        getLocationBtn.addEventListener('click', handleFindVets);
        function handleFindVets() {
            clearUI();
            showLoading("Getting your location...");
            if (!navigator.geolocation) {
                showError("Geolocation is not supported by your browser.");
                return;
            }
            navigator.geolocation.getCurrentPosition(success, error);
        }
        function success(position) {
            showLoading("Finding nearby vets...");
            const { latitude, longitude } = position.coords;
            const animalType = animalTypeSelect.value;
            setTimeout(() => {
                const relevantVets = vets.filter(vet => vet.specialties.includes(animalType));
                if (relevantVets.length === 0) {
                    showError(No vets found specializing in the selected animal type.);
                    return;
                }
                const vetsWithDistance = relevantVets.map(vet => ({
                    ...vet,
                    distance: calculateDistance(latitude, longitude, vet.lat, vet.lon)
                })).sort((a, b) => a.distance - b.distance);
                displayResults(vetsWithDistance);
            }, 1000);
        }
        function error() { showError("Unable to retrieve your location. Please enable location services and try again."); }
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        }
        function displayResults(sortedVets) {
            clearUI();
            if (sortedVets.length === 0) {
                showError(No vets found specializing in the selected animal type.);
                return;
            }
            sortedVets.forEach(vet => {
                resultsContainer.innerHTML += `
                    <div class="border border-gray-200 rounded-xl p-5 bg-white shadow-md hover:shadow-xl transition-shadow duration-300">
                        <div class="flex flex-col md:flex-row justify-between md:items-center mb-3">
                            <h3 class="text-2xl font-bold text-teal-700">${vet.name}</h3>
                            <p class="text-xl font-semibold text-gray-800 bg-teal-100 rounded-full px-4 py-1 mt-2 md:mt-0">${vet.distance.toFixed(1)} km away</p>
                        </div>
                        <p class="text-gray-600 mb-2">${vet.address}</p>
                        <p class="text-gray-600 mb-3"><span class="font-medium">Hours:</span> ${vet.hours}</p>
                        <a href="tel:${vet.phone}" class="inline-flex items-center justify-center w-full md:w-auto bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg>
                            <span>Call: ${vet.phone}</span>
                        </a>
                    </div>`;
            });
        }
        function showLoading(message) { statusContainer.innerHTML = <div class="flex items-center justify-center p-4 bg-blue-50 border border-blue-200 rounded-lg"><div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 mr-3"></div><p class="text-blue-700 font-medium">${message}</p></div>; }
        function showError(message) { statusContainer.innerHTML = <div class="p-4 bg-red-50 border border-red-200 rounded-lg"><p class="text-red-700 font-medium">${message}</p></div>; }
        function clearUI() { resultsContainer.innerHTML = ''; statusContainer.innerHTML = ''; }
    </script>
</body>
</html>